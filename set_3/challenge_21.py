import unittest


def _int32(x):
    return int(0xFFFFFFFF & x)


class MT19937:

    ITERATIONS = 624
    PERIOD = 397
    A = 0x9908B0DF
    B = 0x9D2C5680
    C = 0xEFC60000
    F = 0x6C078965
    L = 18
    S = 7
    T = 15
    U = 11
    W = 32

    def __init__(self, seed):

        self.index = 0
        self.mt = [0] * MT19937.ITERATIONS
        self.mt[0] = seed
        for i in range(1, MT19937.ITERATIONS):
            self.mt[i] = _int32(MT19937.F * (self.mt[i - 1] ^ self.mt[i - 1] >> (MT19937.W - 2)) + i)

    def get_random(self):

        if self.index == 0:
            self.twist()

        y = self.mt[self.index]
        y ^= (y >> MT19937.U)
        y ^= (y << MT19937.S) & MT19937.B
        y ^= (y << MT19937.T) & MT19937.C
        y ^= (y >> MT19937.L)

        self.index = (self.index + 1) % MT19937.ITERATIONS
        return _int32(y)

    def twist(self):

        for i in range(MT19937.ITERATIONS):
            y = _int32((self.mt[i] & 0x80000000) + (self.mt[(i + 1) % MT19937.ITERATIONS] & 0x7FFFFFFF))
            self.mt[i] = self.mt[(i + MT19937.PERIOD) % MT19937.ITERATIONS] ^ y >> 1

            if y % 2 != 0:
                self.mt[i] ^= MT19937.A


class MT19937TestUnit(unittest.TestCase):

    def test_2000(self):

        seed = 1
        prng = MT19937(seed)
        print(len(MT19937TestUnit.expected))
        for i in range(len(MT19937TestUnit.expected)):
            self.assertEqual(prng.get_random(), MT19937TestUnit.expected[i])

    expected = [1791095845, 4282876139, 3093770124, 4005303368, 491263, 550290313,
                1298508491, 4290846341, 630311759, 1013994432, 396591248, 1703301249,
                799981516, 1666063943, 1484172013, 2876537340, 1704103302, 4018109721,
                2314200242, 3634877716, 1800426750, 1345499493, 2942995346, 2252917204,
                878115723, 1904615676, 3771485674, 986026652, 117628829, 2295290254,
                2879636018, 3925436996, 1792310487, 1963679703, 2399554537, 1849836273,
                602957303, 4033523166, 850839392, 3343156310, 3439171725, 3075069929,
                4158651785, 3447817223, 1346146623, 398576445, 2973502998, 2225448249,
                3764062721, 3715233664, 3842306364, 3561158865, 365262088, 3563119320,
                167739021, 1172740723, 729416111, 254447594, 3771593337, 2879896008,
                422396446, 2547196999, 1808643459, 2884732358, 4114104213, 1768615473,
                2289927481, 848474627, 2971589572, 1243949848, 1355129329, 610401323,
                2948499020, 3364310042, 3584689972, 1771840848, 78547565, 146764659,
                3221845289, 2680188370, 4247126031, 2837408832, 3213347012, 1282027545,
                1204497775, 1916133090, 3389928919, 954017671, 443352346, 315096729,
                1923688040, 2015364118, 3902387977, 413056707, 1261063143, 3879945342,
                1235985687, 513207677, 558468452, 2253996187, 83180453, 359158073,
                2915576403, 3937889446, 908935816, 3910346016, 1140514210, 1283895050,
                2111290647, 2509932175, 229190383, 2430573655, 2465816345, 2636844999,
                630194419, 4108289372, 2531048010, 1120896190, 3005439278, 992203680,
                439523032, 2291143831, 1778356919, 4079953217, 2982425969, 2117674829,
                1778886403, 2321861504, 214548472, 3287733501, 2301657549, 194758406,
                2850976308, 601149909, 2211431878, 3403347458, 4057003596, 127995867,
                2519234709, 3792995019, 3880081671, 2322667597, 590449352, 1924060235,
                598187340, 3831694379, 3467719188, 1621712414, 1708008996, 2312516455,
                710190855, 2801602349, 3983619012, 1551604281, 1493642992, 2452463100,
                3224713426, 2739486816, 3118137613, 542518282, 3793770775, 2964406140,
                2678651729, 2782062471, 3225273209, 1520156824, 1498506954, 3278061020,
                1159331476, 1531292064, 3847801996, 3233201345, 1838637662, 3785334332,
                4143956457, 50118808, 2849459538, 2139362163, 2670162785, 316934274,
                492830188, 3379930844, 4078025319, 275167074, 1932357898, 1526046390,
                2484164448, 4045158889, 1752934226, 1631242710, 1018023110, 3276716738,
                3879985479, 3313975271, 2463934640, 1294333494, 12327951, 3318889349,
                2650617233, 656828586, 1402929172, 2485213814, 2263697328, 38689046,
                3805092325, 3045314445, 1534461937, 2021386866, 3902128737, 3283900085,
                2677311316, 2007436298, 67951712, 1155350711, 3991902525, 3572092472,
                2967379673, 2367922581, 4283469031, 300997728, 740196857, 2029264851,
                588993561, 3190150641, 4005467022, 824445069, 2992811220, 1994202740,
                283468587, 989400710, 3244689101, 2182906552, 3237873595, 895794063,
                3964360216, 211760123, 3055975561, 2228494786, 533739719, 739929909,
                85384517, 1702152612, 112575333, 461130488, 121575445, 2189618472,
                1057468493, 438667483, 3693791921, 1240033649]


if __name__ == "__main__":
    unittest.main()



